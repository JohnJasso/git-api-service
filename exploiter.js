const EventEmitter = require('events')
const fetch = require('node-fetch');
const credentials = require('./credentials.json')
const baseURL =  'https://api.github.com/';

// class Exploiter extends EventEmitter {
//     printURL() {
//         console.log('URL: ' + BaseURL)
//         this.emit('gotURL', { id: 1, url: 'thisurl.com'})
//         // this.emit("gotURL", "thisisurl.com ");
//     }
// }

async function searchRepos(search_term) {
    const url = new URL(`${baseURL}search/repositories?q=${search_term}`);
    try {
      const response = await fetch(url);
      const json = await response.json();
      return json;
    } catch (error) {
      console.log('Server error: ', error);
    }
}

async function listStars() {
    const url = new URL(`${baseURL}users/${credentials.username}/starred`);
    try {
      const response = await fetch(url);
      const json = await response.json();
      console.log(json);
    } catch (error) {
      console.log("Server error: ", error);
    }
}

async function listStarsAuth() {
  const url = new URL(`${baseURL}user/starred`);
  url.username = credentials.username;
  url.password = credentials.password;
  try {
    const response = await fetch(url);
    const json = await response.json();
    console.log(json);
  } catch (error) {
    console.log("Server error: ", error);
  }
}

async function listStarsAuth() {
  const url = new URL(`${baseURL}user/starred`);
  url.username = credentials.username;
  url.password = credentials.password;
  try {
    const response = await fetch(url);
    const json = await response.json();
    console.log(json);
  } catch (error) {
    console.log("Server error: ", error);
  }
}

module.exports.search = searchRepos;
module.exports.list = listStars;
module.exports.listAuth = listStarsAuth;
module.exports.creds = credentials;